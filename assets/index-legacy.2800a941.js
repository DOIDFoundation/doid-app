System.register(["./index-legacy.0e50bc3e.js","./doid-symbol-legacy.f4eb6e1c.js","./vendor-legacy.0fa2a4d9.js"],(function(t,e){"use strict";var i,s,n,a,r,o,c,l,h,d,p,m,g,u,y,b,w,f,v,x,$;return{setters:[t=>{i=t.n,s=t.e,n=t._,a=t.f,r=t.h,o=t.T,c=t.r,l=t.d},t=>{h=t.g,d=t.a,p=t.b,m=t.c,g=t.w,u=t.n},t=>{y=t.x,b=t.y,w=t.d,f=t.f,v=t.h,x=t.e,$=t.n}],execute:function(){class k{constructor(t,{errorCodes:e="",seq:i,delay:s=0,allowAlmostSuccess:n=!1,onSent:a=(()=>{})}={}){this.pending=!0,this.status=-1,this.allowAlmostSuccess=n,this.txPromise=t,this.err=void 0,this.hash="",this.errorCodes=e,this.seq=i,this.delay=s,this.onSent=a}get success(){return 1===this.status}get almostSuccess(){return 4===this.status}get ignored(){return 3===this.status}async wait(t=!1){return(async()=>{let r=!1;const o=await(async t=>t?"object"==typeof t?t:await n(Object.assign({"./abi/Locker.codes.json":()=>a((()=>e.import("./Locker.codes-legacy.d5ca7e1e.js")),void 0),"./abi/Resolver.codes.json":()=>a((()=>e.import("./Resolver.codes-legacy.77c566ca.js")),void 0)}),`./abi/${t}.codes.json`):{})(this.errorCodes);try{const e=await this.txPromise;this.onSent(e);const{hash:i,nonce:n}=e;this.seq.nonce=n,this.seq&&(delete this.seq.overrides,h().add(Object.assign(this.seq,{hash:i}))),this.hash=i,this.status=2;const a=async()=>{const{status:t,events:s}=await e.wait(1);if(1!==t)throw this.seq&&(this.seq.err=!0),new Error("Failed");s.some((({event:t,args:e}={})=>{if("Failure"===t){let{info:t,detail:i,error:s}=e;const n=s.toString(),a=o[s],r={code:n,message:a,error:s,info:t?.toString(),detail:i?.toString()};this.seq&&(this.seq.err=!0);const c=new Error(a);throw Object.assign(c,{code:n,raw:r}),this.allowAlmostSuccess&&(this.status=4),c}})),this.status=1,this.seq&&(this.seq.done=!0),this.delay?h().delDelay(i,this.delay):h().del(i)};t?(r=!0,a()):await a()}catch(c){throw await i(c),4001===c.code?this.status=3:4!==this.status&&(this.status=0),this.err=c,c}finally{this.pending=!1;const t=1===this.status;s.emit("tx-status",this.hash),t&&s.emit("tx-success",this.hash),r=t}return r})()}}const j=async t=>`${await m()}.${t}`,q=()=>(new Date).getTime(),C=async t=>{const e=sessionStorage.getItem(await j(t));if(e)return JSON.parse(e)},S=async(t,e)=>{const i=await C(t)||{};Object.assign(i,e),sessionStorage.setItem(await j(t),JSON.stringify(i))},O=async t=>{const e=await(async(t,e,i="",s=[])=>{const n=await C(t);if(n)return n;const a=await d();e||(e=await p());const r={secret:await a.makeCommitment(t,e,y(i),s),ts:q()};return await S(t,r),r})(t),i=await d(),[s,n]=["commit",{}],a=[e.secret];await r(n,i,s,a);const o=i[s](...a);return new k(o,{errorCodes:"Resolver",seq:{type:"commit",title:"Commit",ts:q(),overrides:n},onSent:()=>S(t,{ts:q()})})};var D=Object.defineProperty,R=Object.getOwnPropertyDescriptor,I=(t,e,i,s)=>{for(var n,a=s>1?void 0:s?R(e,i):e,r=t.length-1;r>=0;r--)(n=t[r])&&(a=(s?n(e,i,a):n(a))||a);return s&&a&&D(e,i,a),a};let P=class extends(o('ol{margin-top:1rem;margin-bottom:1rem;display:grid;grid-gap:1rem;gap:1rem}@media (min-width: 768px){ol{grid-template-columns:repeat(3,minmax(0,1fr))}}ol li{position:relative;display:inline-flex;flex-direction:column;gap:1rem;border-radius:.375rem;--tw-bg-opacity: 1;background-color:rgba(243,244,246,var(--tw-bg-opacity));padding:1.25rem 1rem 1rem 3.5rem}ol li:before{position:absolute;left:.75rem;top:.75rem;display:flex;height:2rem;width:2rem;align-items:center;justify-content:center;border-radius:9999px;border-width:1px;--tw-bg-opacity: 1;background-color:rgba(255,255,255,var(--tw-bg-opacity));font-weight:700}ol li.active{--tw-bg-opacity: 1;background-color:rgba(226,232,240,var(--tw-bg-opacity))}ol li.active:before{--tw-border-opacity: 1;border-color:rgba(148,163,184,var(--tw-border-opacity))}ol li>b{display:block}ol li:nth-child(1):before{content:"1"}ol li:nth-child(2):before{content:"2"}ol li:nth-child(3):before{content:"3"}\n')){constructor(){super(...arguments),this.name="",this.pending=!1,this.ts=0,this.step=1,this.tx=null,this.get=async()=>{this.ts++},this.commit=async()=>{this.pending=!0;try{this.tx=await O(this.name),await this.tx.wait(),this.step=2}catch(t){if("4001"===t.code)return;/( IC)/.test(t.message)&&(this.step=2)}finally{this.pending=!1}}}get btnDisabled(){return this.pending}get txSuccess(){return this.tx&&!this.tx.ignored}connectedCallback(){this.get(),super.connectedCallback()}render(){return b`<div class="px-3"><h3 class="text-base">Registering a name requires you to complete 3 steps</h3><ol><li class="${w({active:this.step>=1})}"><b>Request to register</b><p>Your wallet will open and you will be asked to confirm the first of two transactions required for registration. If the second transaction is not processed within 7 days of the first, you will need to start again from step 1.</p></li><li class="${w({active:this.step>=2})}"><b>Wait for 1 minute</b><p>The waiting period is required to ensure another person hasn’t tried to register the same name and protect you after your request.</p></li><li class="${w({active:3===this.step})}"><b>Complete Registration</b><p>Click ‘register’ and your wallet will re-open. Only after the 2nd transaction is confirmed you'll know if you got the name.</p></li></ol><p class="text-center"><dui-button @click="${this.commit}" ?disabled="${this.btnDisabled}" ?pending="${this.pending}">Request to Register<i class="mdi ml-2 ${w(this.$c([this.pending?"mdi-loading":"mdi-chevron-right"]))}"></i></dui-button></p></div>`}};I([v()],P.prototype,"name",2),I([f()],P.prototype,"pending",2),I([f()],P.prototype,"ts",2),I([f()],P.prototype,"step",2),I([f()],P.prototype,"tx",2),P=I([x("view-name-register")],P);var N=Object.defineProperty,A=Object.getOwnPropertyDescriptor,L=(t,e,i,s)=>{for(var n,a=s>1?void 0:s?A(e,i):e,r=t.length-1;r>=0;r--)(n=t[r])&&(a=(s?n(e,i,a):n(a))||a);return s&&a&&N(e,i,a),a};let T=class extends(o("")){constructor(){super(...arguments),this.name="",this.pending=!1,this.ts=0,this.get=async()=>{this.ts++}}get empty(){return!1}connectedCallback(){this.get(),super.connectedCallback()}render(){return b`<div class="px-3">Details for ${this.name}</div>`}};L([v()],T.prototype,"name",2),L([f()],T.prototype,"pending",2),L([f()],T.prototype,"ts",2),T=L([x("view-name-details")],T);var E=Object.defineProperty,F=Object.getOwnPropertyDescriptor,J=(t,e,i,s)=>{for(var n,a=s>1?void 0:s?F(e,i):e,r=t.length-1;r>=0;r--)(n=t[r])&&(a=(s?n(e,i,a):n(a))||a);return s&&a&&E(e,i,a),a};let V=t("ViewName",class extends(o(":host::part(dui-nav){display:flex;margin-bottom:-2px}\n")){constructor(){super(...arguments),this.name="",this.action="",this.pending=!1,this.disconnected=!1,this.nameInfo=null,this.goto=()=>{c(`/name/${g(this.name)}/${this.action}`)},this.check=async(t,e=!1)=>{if(this.pending)return;if(this.pending=!0,await this.isDisconnected(e))return;const i=g(this.name);if(this.name!==i)this.name=i;else try{if(this.nameInfo=await u(this.name),!this.isConnected)return;this.action||(this.action=this.nameInfo.available?"register":"details")}catch(s){this.nameInfo=null}this.goto(),this.pending=!1}}get inReg(){return this.name&&!this.pending&&"register"===this.action}get inDetails(){return this.name&&!this.pending&&"details"===this.action}get empty(){return!this.name}connectedCallback(){super.connectedCallback(),this.check(null,!0),s.on("router-change",this.check)}disconnectedCallback(){console.log("dis"),super.disconnectedCallback(),s.off("router-change",this.check)}render(){return b`<div class="view-name"><div class="dui-container"><dui-ns-search .text="${this.name}" @search="${t=>l(`/search/${t.detail}`)}" placeholder="Search names"><span slot="label"></span> <span slot="msgd"></span></dui-ns-search>${$(this.name,(()=>b`<div class="border-b-2 flex my-4 px-3 pr-4 justify-between"><div><b>${this.name}</b> ${$("doid"===this.name,(()=>b`<em>(Registrant)</em>`))}</div><div><dui-nav slot="center" part="dui-nav"><dui-link href="${`/name/${this.name}/register`}" alias="${`/name/${this.name}`}" exact nav>Register</dui-link><dui-link href="${`/name/${this.name}/details`}" exact nav>Details</dui-link></dui-nav></div></div>`))} ${$(this.pending,(()=>b`<i class="mdi mdi-loading"></i> Loading...`))} ${$(this.inReg,(()=>b`<view-name-register .name="${this.name}"></view-name-register>`))} ${$(this.inDetails,(()=>b`<view-name-details .name="${this.name}"></view-name-details>`))}</div></div>`}});J([v()],V.prototype,"name",2),J([v()],V.prototype,"action",2),J([f()],V.prototype,"pending",2),J([f()],V.prototype,"disconnected",2),J([f()],V.prototype,"nameInfo",2),t("ViewName",V=J([x("view-name")],V))}}}));
