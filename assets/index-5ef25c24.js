import{n as J,e as f,_ as z,f as j,h as B,T as O,r as H,d as K}from"./index-84b62280.js";import{g as _,a as I,b as M,c as Q,w as S,n as W}from"./doid-symbol-a9666400.js";import{x as Y,y as c,d as g,f as o,h as w,e as D,n as p}from"./vendor-3b8086e8.js";const G=async e=>e?typeof e=="object"?e:await z(Object.assign({"./abi/Locker.codes.json":()=>j(()=>import("./Locker.codes-d3f42ed5.js"),[]),"./abi/Resolver.codes.json":()=>j(()=>import("./Resolver.codes-ee4f74d3.js"),[])}),`./abi/${e}.codes.json`):{};class U{constructor(s,{errorCodes:i="",seq:a=void 0,delay:t=0,allowAlmostSuccess:n=!1,onSent:r=()=>{}}={}){this.pending=!0,this.status=-1,this.allowAlmostSuccess=n,this.txPromise=s,this.err=void 0,this.hash="",this.errorCodes=i,this.seq=a,this.delay=t,this.onSent=r}get success(){return this.status===1}get almostSuccess(){return this.status===4}get ignored(){return this.status===3}async wait(s=!1){return(async()=>{let i=!1;const a=await G(this.errorCodes);try{const t=await this.txPromise;this.onSent(t);const{hash:n,nonce:r}=t;this.seq.nonce=r,this.seq&&(delete this.seq.overrides,_().add(Object.assign(this.seq,{hash:n}))),this.hash=n,this.status=2;const b=async()=>{const{status:A,events:L}=await t.wait(1);if(A!==1)throw this.seq&&(this.seq.err=!0),new Error("Failed");L.some(({event:N,args:V}={})=>{if(N==="Failure"){let{info:y,detail:x,error:$}=V;const R=$.toString(),q=a[$],F={code:R,message:q,error:$,info:y==null?void 0:y.toString(),detail:x==null?void 0:x.toString()};this.seq&&(this.seq.err=!0);const P=new Error(q);throw Object.assign(P,{code:R,raw:F}),this.allowAlmostSuccess&&(this.status=4),P}}),this.status=1,this.seq&&(this.seq.done=!0),this.delay?_().delDelay(n,this.delay):_().del(n)};s?(i=!0,b()):await b()}catch(t){throw await J(t),t.code===4001?this.status=3:this.status!==4&&(this.status=0),this.err=t,t}finally{this.pending=!1;const t=this.status===1;f.emit("tx-status",this.hash),t&&f.emit("tx-success",this.hash),i=t}return i})()}}const k=async e=>`${await Q()}.${e}`,C=()=>new Date().getTime(),E=async e=>{const s=sessionStorage.getItem(await k(e));if(s)return JSON.parse(s)},T=async(e,s)=>{const i=await E(e)||{};Object.assign(i,s),sessionStorage.setItem(await k(e),JSON.stringify(i))},X=async(e,s,i="",a=[])=>{const t=await E(e);if(t)return t;const n=await I();s||(s=await M());const r={secret:await n.makeCommitment(e,s,Y(i),a),ts:C()};return await T(e,r),r},Z=async e=>{const s=await X(e),i=await I(),[a,t]=["commit",{}],n=[s.secret];await B(t,i,a,n);const r=i[a](...n);return new U(r,{errorCodes:"Resolver",seq:{type:"commit",title:"Commit",ts:C(),overrides:t},onSent:()=>T(e,{ts:C()})})},tt=`ol{margin-top:1rem;margin-bottom:1rem;display:grid;grid-gap:1rem;gap:1rem}@media (min-width: 768px){ol{grid-template-columns:repeat(3,minmax(0,1fr))}}ol li{position:relative;display:inline-flex;flex-direction:column;gap:1rem;border-radius:.375rem;--tw-bg-opacity: 1;background-color:rgba(243,244,246,var(--tw-bg-opacity));padding:1.25rem 1rem 1rem 3.5rem}ol li:before{position:absolute;left:.75rem;top:.75rem;display:flex;height:2rem;width:2rem;align-items:center;justify-content:center;border-radius:9999px;border-width:1px;--tw-bg-opacity: 1;background-color:rgba(255,255,255,var(--tw-bg-opacity));font-weight:700}ol li.active{--tw-bg-opacity: 1;background-color:rgba(226,232,240,var(--tw-bg-opacity))}ol li.active:before{--tw-border-opacity: 1;border-color:rgba(148,163,184,var(--tw-border-opacity))}ol li>b{display:block}ol li:nth-child(1):before{content:"1"}ol li:nth-child(2):before{content:"2"}ol li:nth-child(3):before{content:"3"}
`;var et=Object.defineProperty,st=Object.getOwnPropertyDescriptor,d=(e,s,i,a)=>{for(var t=a>1?void 0:a?st(s,i):s,n=e.length-1,r;n>=0;n--)(r=e[n])&&(t=(a?r(s,i,t):r(t))||t);return a&&t&&et(s,i,t),t};let l=class extends O(tt){constructor(){super(...arguments),this.name="",this.pending=!1,this.ts=0,this.step=1,this.tx=null,this.get=async()=>{this.ts++},this.commit=async()=>{this.pending=!0;try{this.tx=await Z(this.name);const e=await this.tx.wait();this.step=2}catch(e){if(e.code==="4001")return;/( IC)/.test(e.message)&&(this.step=2)}finally{this.pending=!1}}}get btnDisabled(){return this.pending}get txSuccess(){return this.tx&&!this.tx.ignored}connectedCallback(){this.get(),super.connectedCallback()}render(){return c`<div class="px-3"><h3 class="text-base">Registering a name requires you to complete 3 steps</h3><ol><li class="${g({active:this.step>=1})}"><b>Request to register</b><p>Your wallet will open and you will be asked to confirm the first of two transactions required for registration. If the second transaction is not processed within 7 days of the first, you will need to start again from step 1.</p></li><li class="${g({active:this.step>=2})}"><b>Wait for 1 minute</b><p>The waiting period is required to ensure another person hasn’t tried to register the same name and protect you after your request.</p></li><li class="${g({active:this.step===3})}"><b>Complete Registration</b><p>Click ‘register’ and your wallet will re-open. Only after the 2nd transaction is confirmed you'll know if you got the name.</p></li></ol><p class="text-center"><dui-button @click="${this.commit}" ?disabled="${this.btnDisabled}" ?pending="${this.pending}">Request to Register<i class="mdi ml-2 ${g(this.$c([this.pending?"mdi-loading":"mdi-chevron-right"]))}"></i></dui-button></p></div>`}};d([w()],l.prototype,"name",2);d([o()],l.prototype,"pending",2);d([o()],l.prototype,"ts",2);d([o()],l.prototype,"step",2);d([o()],l.prototype,"tx",2);l=d([D("view-name-register")],l);const it="";var at=Object.defineProperty,nt=Object.getOwnPropertyDescriptor,v=(e,s,i,a)=>{for(var t=a>1?void 0:a?nt(s,i):s,n=e.length-1,r;n>=0;n--)(r=e[n])&&(t=(a?r(s,i,t):r(t))||t);return a&&t&&at(s,i,t),t};let u=class extends O(it){constructor(){super(...arguments),this.name="",this.pending=!1,this.ts=0,this.get=async()=>{this.ts++}}get empty(){return!1}connectedCallback(){this.get(),super.connectedCallback()}render(){return c`<div class="px-3">Details for ${this.name}</div>`}};v([w()],u.prototype,"name",2);v([o()],u.prototype,"pending",2);v([o()],u.prototype,"ts",2);u=v([D("view-name-details")],u);const rt=`:host::part(dui-nav){display:flex;margin-bottom:-2px}
`;var ot=Object.defineProperty,ct=Object.getOwnPropertyDescriptor,m=(e,s,i,a)=>{for(var t=a>1?void 0:a?ct(s,i):s,n=e.length-1,r;n>=0;n--)(r=e[n])&&(t=(a?r(s,i,t):r(t))||t);return a&&t&&ot(s,i,t),t};let h=class extends O(rt){constructor(){super(...arguments),this.name="",this.action="",this.pending=!1,this.disconnected=!1,this.nameInfo=null,this.goto=()=>{H(`/name/${S(this.name)}/${this.action}`)},this.check=async(e,s=!1)=>{if(this.pending||(this.pending=!0,await this.isDisconnected(s)))return;const i=S(this.name);if(this.name!==i)this.name=i;else try{if(this.nameInfo=await W(this.name),!this.isConnected)return;this.action||(this.action=this.nameInfo.available?"register":"details")}catch(a){this.nameInfo=null}this.goto(),this.pending=!1}}get inReg(){return this.name&&!this.pending&&this.action==="register"}get inDetails(){return this.name&&!this.pending&&this.action==="details"}get empty(){return!this.name}connectedCallback(){super.connectedCallback(),this.check(null,!0),f.on("router-change",this.check)}disconnectedCallback(){console.log("dis"),super.disconnectedCallback(),f.off("router-change",this.check)}render(){return c`<div class="view-name"><div class="dui-container"><dui-ns-search .text="${this.name}" @search="${e=>K(`/search/${e.detail}`)}" placeholder="Search names"><span slot="label"></span> <span slot="msgd"></span></dui-ns-search>${p(this.name,()=>c`<div class="border-b-2 flex my-4 px-3 pr-4 justify-between"><div><b>${this.name}</b> ${p(this.name==="doid",()=>c`<em>(Registrant)</em>`)}</div><div><dui-nav slot="center" part="dui-nav"><dui-link href="${`/name/${this.name}/register`}" alias="${`/name/${this.name}`}" exact nav>Register</dui-link><dui-link href="${`/name/${this.name}/details`}" exact nav>Details</dui-link></dui-nav></div></div>`)} ${p(this.pending,()=>c`<i class="mdi mdi-loading"></i> Loading...`)} ${p(this.inReg,()=>c`<view-name-register .name="${this.name}"></view-name-register>`)} ${p(this.inDetails,()=>c`<view-name-details .name="${this.name}"></view-name-details>`)}</div></div>`}};m([w()],h.prototype,"name",2);m([w()],h.prototype,"action",2);m([o()],h.prototype,"pending",2);m([o()],h.prototype,"disconnected",2);m([o()],h.prototype,"nameInfo",2);h=m([D("view-name")],h);export{h as ViewName};
